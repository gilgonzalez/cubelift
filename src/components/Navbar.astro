---
import { getPath, getTranslations } from "../i18n/utils";
import { routes } from "../i18n/routes";
import LanguageSelector from "./LanguageSelector.astro";

const { lang } = Astro.props;
const t = getTranslations(lang);
const currentPath = Astro.url.pathname;

const normalizePath = (path: string) => path.replace(/\/$/, "") || "/";
const isCurrent = (href: string) => normalizePath(currentPath) === normalizePath(href);

const links = (Object.keys(routes) as Array<keyof typeof routes>).map((key) => ({
  href: getPath(key, lang),
  label: t.navbar[key],
}));
---

<nav class="bg-black flex justify-between items-center px-6 md:px-24 py-4 relative z-50">
  <a href={getPath("home", lang)}>
    <img src="/brand/logo.png" alt="Logo" class="h-10 w-auto" />
  </a>

  <!-- Desktop Menu -->
  <div class="hidden md:flex gap-8 items-center">
    {
      links.map((link) => (
        <a
          href={link.href}
          class={`text-lg transition-colors duration-200 ${
            isCurrent(link.href)
              ? "font-bold text-primary"
              : "text-white hover:text-primary"
          }`}
        >
          {link.label}
        </a>
      ))
    }
    <LanguageSelector lang={lang} />
  </div>

  <!-- Mobile Hamburger Button -->
  <button
    id="menu-toggle"
    class="md:hidden text-white focus:outline-none z-50 relative w-8 h-8 flex flex-col justify-center gap-1.5"
    aria-label="Toggle Menu"
  >
    <span
      class="block w-full h-0.5 bg-white transition-all duration-300 origin-center"
      id="hamburger-top"></span>
    <span
      class="block w-full h-0.5 bg-white transition-all duration-300 origin-center"
      id="hamburger-middle"></span>
    <span
      class="block w-full h-0.5 bg-white transition-all duration-300 origin-center"
      id="hamburger-bottom"></span>
  </button>

  <!-- Mobile Sheet -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-black/95 backdrop-blur-sm transform translate-x-full transition-transform duration-300 md:hidden flex flex-col items-center justify-center gap-8 z-40"
  >
    {
      links.map((link) => (
        <a
          href={link.href}
          class={`text-2xl transition-colors duration-200 ${
            isCurrent(link.href)
              ? "font-bold text-primary"
              : "text-white"
          }`}
        >
          {link.label}
        </a>
      ))
    }
    <LanguageSelector lang={lang}  />
  </div>
</nav>

<script>
  const menuToggle = document.getElementById("menu-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const topBar = document.getElementById("hamburger-top");
  const middleBar = document.getElementById("hamburger-middle");
  const bottomBar = document.getElementById("hamburger-bottom");
  let isOpen = false;

  menuToggle?.addEventListener("click", () => {
    isOpen = !isOpen;
    if (isOpen) {
      mobileMenu?.classList.remove("translate-x-full");
      document.body.style.overflow = "hidden";

      // Animate Hamburger to X
      topBar?.classList.add("rotate-45", "translate-y-2");
      middleBar?.classList.add("opacity-0");
      bottomBar?.classList.add("-rotate-45", "-translate-y-2");
    } else {
      mobileMenu?.classList.add("translate-x-full");
      document.body.style.overflow = "";

      // Animate X back to Hamburger
      topBar?.classList.remove("rotate-45", "translate-y-2");
      middleBar?.classList.remove("opacity-0");
      bottomBar?.classList.remove("-rotate-45", "-translate-y-2");
    }
  });
</script>
